<mat-card class="student-card">
    <mat-card-title>{{ title }}</mat-card-title>
    <mat-card-content>
        <table mat-table [dataSource]="isLoading ? [] : dataSource" matSort (matSortChange)="sortChanged.emit($event)" class="mat-elevation-z8">
            <ng-container matColumnDef="code" *ngIf="columns.includes('code')">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Şagirdin kodu </th>
                <td mat-cell *matCellDef="let result">
                    {{ result.studentData.code }}
                </td>
            </ng-container>
            
            <ng-container matColumnDef="lastName" *ngIf="columns.includes('lastName')">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Soyadı </th>
                <td mat-cell *matCellDef="let result">
                    {{ result.studentData.lastName }}
                </td>
            </ng-container>

            <ng-container matColumnDef="firstName" *ngIf="columns.includes('firstName')">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Adı </th>
                <td mat-cell *matCellDef="let result">
                    {{ result.studentData.firstName }}
                </td>
            </ng-container>

            <ng-container matColumnDef="middleName" *ngIf="columns.includes('middleName')">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Ata adı </th>
                <td mat-cell *matCellDef="let result">
                    {{ result.studentData.middleName }}
                </td>
            </ng-container>
    
            <ng-container matColumnDef="totalScore" *ngIf="columns.includes('totalScore')">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> İmtahandakı toplam balı </th>
                <td mat-cell *matCellDef="let result"> {{ result.totalScore }} </td>
            </ng-container>

            <ng-container matColumnDef="grade" *ngIf="columns.includes('grade')">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Sinfi </th>
                <td mat-cell *matCellDef="let result">
                {{ result.studentData.grade }}
                </td>
            </ng-container>

            <ng-container matColumnDef="teacher" *ngIf="columns.includes('teacher')">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Müəllimi </th>
                <td mat-cell *matCellDef="let result"> {{ (result.studentData.teacher || '').fullname }} </td>
            </ng-container>

            <ng-container matColumnDef="school" *ngIf="columns.includes('school')">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Məktəbi </th>
                <td mat-cell *matCellDef="let result"> {{ (result.studentData.school || '').name }} </td>
            </ng-container>
            
            <ng-container matColumnDef="district" *ngIf="columns.includes('district')">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Rayonu / şəhəri </th>
                <td mat-cell *matCellDef="let result"> {{ (result.studentData.district || '').name }} </td>
            </ng-container>
    
            <ng-container matColumnDef="status" *ngIf="columns.includes('status')">
                <th mat-header-cell *matHeaderCellDef> Statusu </th>
                <td mat-cell *matCellDef="let result"> {{ result.studentData.status }} </td>
            </ng-container>

            <ng-container matColumnDef="averageScore" *ngIf="columns.includes('averageScore')">
                <th mat-header-cell *matHeaderCellDef> Orta balı </th>
                <td mat-cell *matCellDef="let result"> {{ (result.studentData || '').averageScore }} </td>
            </ng-container>
    
            <tr mat-header-row *matHeaderRowDef="columns"></tr>
            <tr mat-row *matRowDef="let row; columns: columns;" class="clickable-row" (click)="onRowClick(row.studentData._id)"></tr>
        </table>

        <div>
            <button mat-raised-button (click)="onExportToExcel(tableName)" *ngIf="dataSource.length > 0">
                <mat-icon>file_download</mat-icon> Excel-ə eksport et
            </button>
        </div>
    </mat-card-content>
</mat-card>